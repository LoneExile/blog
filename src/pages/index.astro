---
import MainLayout from "@layouts/MainLayout.astro";
import Hero from "@components/Hero.astro";
import InfiniteScroll from "@components/InfiniteScroll.astro";
import NewSletter from "@components/NewSletter.astro";
import { getRelativeLocaleUrl } from "astro:i18n";
import { getCollection } from "astro:content";

interface Props {
  language: string;
}
let { language } = Astro.props;
if (!language) {
  language = "en";
}

// interface SiteData {
//   siteDescription: string;
//   siteTitle: string;
//   author: string;
// }

let data;
if (language === "th") {
  data = await import("@data/th.json").then((module) => module.default);
} else {
  data = await import("@data/en.json").then((module) => module.default);
}

const title = data.siteTitle;
const currentPath = getRelativeLocaleUrl(language, "");

let posts = await getCollection("blogs", ({ data }) => {
  if (import.meta.env.PROD) {
    return data.draft !== true;
  } else {
    return true;
  }
});
posts = posts.filter((post) => post.data.show === undefined || post.data.show);
---

<MainLayout description={data.siteDescription} {currentPath} {language} {title}>
  <Hero />
  <InfiniteScroll {posts} {language} />
  <NewSletter {language} />
</MainLayout>
