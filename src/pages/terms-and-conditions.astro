---
import MainLayout from "@layouts/MainLayout.astro";
import Post from "@components/Post.astro";
import { getCollection } from "astro:content";

interface Props {
  language: string;
}
let { language } = Astro.props;
if (!language) {
  language = "en";
}

let posts = await getCollection("blogs", ({ slug }) => {
  if (slug === "terms-and-conditions") {
    return true;
  }
});
const entry = posts[0];

const { Content } = await entry.render();
const currentPath = entry.slug;
const title = entry.data.title;

if (entry === undefined) {
  return Astro.redirect(getRelativeLocaleUrl(language, "404/"));
}

export async function getStaticPaths() {
  const blogEntries = await getCollection("blogs", ({ data }) => {
    if (import.meta.env.PROD) {
      return data.draft !== true;
    } else {
      return true;
    }
  });

  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}
---

<MainLayout
  description={entry.data.description}
  {currentPath}
  {language}
  {title}
>
  <Post
    title={entry.data.title}
    created={entry.data.created}
    updated={entry.data.updated}
    draft={entry.data.draft}
    tags={entry.data.tags}
    description={entry.data.description}
    url={entry.slug}
    {language}
    comments={entry.data.comments}
  >
    <Content />
  </Post>
</MainLayout>
